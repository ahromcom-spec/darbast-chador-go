# ğŸ”” Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† PWA - Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ù‡Ø±Ù…

## âœ… Ø¢Ù†Ú†Ù‡ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª

### 1. **PWA Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ù†ØµØ¨**
- âœ¨ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ú©Ø§Ù…Ù„ `vite-plugin-pwa`
- ğŸ“± Manifest ÙØ§Ø±Ø³ÛŒ Ø¨Ø§ RTL Support
- ğŸ¨ Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ÛŒ PWA (512x512)
- âš¡ Service Worker Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Cache
- ğŸ”„ Auto-update

### 2. **Ø³ÛŒØ³ØªÙ… Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†**
- ğŸ”” Hook Ø³ÙØ§Ø±Ø´ÛŒ `usePushNotifications`
- ğŸ“„ ØµÙØ­Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† (`/settings/notifications`)
- ğŸ“² ØµÙØ­Ù‡ Ù†ØµØ¨ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† (`/settings/install`)
- ğŸ¯ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Notification Prompt Ø¯Ø± ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ

### 3. **Ø§Ù…Ú©Ø§Ù†Ø§Øª Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡**
- âœ… ØªØ´Ø®ÛŒØµ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¯Ø³ØªÚ¯Ø§Ù‡
- âœ… Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬ÙˆØ² Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
- âœ… Ø§Ø´ØªØ±Ø§Ú© Ø¯Ø± Push Notifications
- âœ… Ø§Ø±Ø³Ø§Ù„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† ØªØ³Øª
- âœ… Ù„ØºÙˆ Ø§Ø´ØªØ±Ø§Ú©
- âœ… Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù†ØµØ¨ Ø¨Ø±Ø§ÛŒ iOS Ùˆ Android

---

## ğŸ“± Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡

### Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†:

#### **1. Ù†ØµØ¨ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†**

**Ø±ÙˆÛŒ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯:**
1. Ø§Ø² Ù…Ù†ÙˆÛŒ Ù…Ø±ÙˆØ±Ú¯Ø± (Ø³Ù‡ Ù†Ù‚Ø·Ù‡) Ú¯Ø²ÛŒÙ†Ù‡ "Add to Home Screen" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯
2. Ø±ÙˆÛŒ "Install" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
3. Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø±ÙˆÛŒ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ù†ØµØ¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯

**Ø±ÙˆÛŒ iOS:**
1. Ø¯Ø± Safari Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Share (Ù…Ø±Ø¨Ø¹ Ø¨Ø§ ÙÙ„Ø´) Ø¨Ø²Ù†ÛŒØ¯
2. "Add to Home Screen" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
3. Ø±ÙˆÛŒ "Add" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯

#### **2. ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†**
1. Ø¨Ø¹Ø¯ Ø§Ø² Ù†ØµØ¨ØŒ Ø¨Ù‡ `/settings/notifications` Ø¨Ø±ÙˆÛŒØ¯
2. Ø±ÙˆÛŒ "ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
3. Ø¨Ù‡ Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø¬Ø§Ø²Ù‡ Ø§Ø±Ø³Ø§Ù„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¯Ù‡ÛŒØ¯
4. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÛŒÚ© Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† ØªØ³ØªÛŒ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯

---

## ğŸ”§ Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†

### Ù†Ø­ÙˆÙ‡ Ø§Ø±Ø³Ø§Ù„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø§Ø² Backend

#### **Ø±ÙˆØ´ 1: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Supabase Edge Function**

ÛŒÚ© Edge Function Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯:

\`\`\`typescript
// supabase/functions/send-push-notification/index.ts
import { serve } from 'https://deno.land/std@0.177.0/http/server.ts';

serve(async (req) => {
  const { subscription, title, body, data } = await req.json();

  const pushPayload = {
    notification: {
      title,
      body,
      icon: '/ahrom-app-icon.png',
      badge: '/ahrom-app-icon.png',
      data
    }
  };

  // Ø§Ø±Ø³Ø§Ù„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² web-push
  const response = await fetch(subscription.endpoint, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'TTL': '86400', // 24 hours
      // VAPID headers
    },
    body: JSON.stringify(pushPayload)
  });

  return new Response(JSON.stringify({ success: true }), {
    headers: { 'Content-Type': 'application/json' }
  });
});
\`\`\`

#### **Ø±ÙˆØ´ 2: Ø°Ø®ÛŒØ±Ù‡ Subscriptions Ø¯Ø± Database**

Ø¬Ø¯ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ subscriptions:

\`\`\`sql
CREATE TABLE push_subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) NOT NULL,
  endpoint TEXT NOT NULL,
  keys JSONB NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_id, endpoint)
);

-- Enable RLS
ALTER TABLE push_subscriptions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage own subscriptions"
  ON push_subscriptions
  FOR ALL
  USING (auth.uid() = user_id);
\`\`\`

#### **Ø±ÙˆØ´ 3: ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Triggers**

Ù…Ø«Ø§Ù„: Ø§Ø±Ø³Ø§Ù„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† ÙˆÙ‚ØªÛŒ Ø³ÙØ§Ø±Ø´ ØªØ§ÛŒÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯:

\`\`\`sql
CREATE OR REPLACE FUNCTION send_push_on_order_approval()
RETURNS TRIGGER AS $$
BEGIN
  IF OLD.status = 'pending' AND NEW.status = 'approved' THEN
    -- ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ edge function Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ push
    PERFORM http_post(
      'https://your-edge-function-url/send-push',
      json_build_object(
        'user_id', NEW.customer_id,
        'title', 'Ø³ÙØ§Ø±Ø´ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯',
        'body', 'Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø¨Ø§ Ú©Ø¯ ' || NEW.code || ' ØªØ§ÛŒÛŒØ¯ Ø´Ø¯'
      )
    );
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER order_approval_push
  AFTER UPDATE ON projects_v3
  FOR EACH ROW
  EXECUTE FUNCTION send_push_on_order_approval();
\`\`\`

---

## âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª VAPID

Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Push Notifications ÙˆØ§Ù‚Ø¹ÛŒØŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ VAPID keys Ø¯Ø§Ø±ÛŒØ¯:

### ØªÙˆÙ„ÛŒØ¯ VAPID Keys:

\`\`\`bash
npx web-push generate-vapid-keys
\`\`\`

### Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Environment Variables:

\`\`\`.env
VITE_VAPID_PUBLIC_KEY=your-public-key
VAPID_PRIVATE_KEY=your-private-key  # ÙÙ‚Ø· Ø³Ø±ÙˆØ±
\`\`\`

### Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Hook:

ÙØ§ÛŒÙ„ \`src/hooks/usePushNotifications.ts\` Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯:

\`\`\`typescript
const vapidPublicKey = import.meta.env.VITE_VAPID_PUBLIC_KEY;
\`\`\`

---

## ğŸ“Š Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ Ùˆ Ù†Ú©Ø§Øª Ù…Ù‡Ù…

### âœ… **Ú†ÛŒØ²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯:**

- âœ… Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¯Ø± **Android Chrome/Edge/Firefox** (Ú©Ø§Ù…Ù„)
- âœ… Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¯Ø± **Desktop Chrome/Edge/Firefox**
- âœ… Ù†ØµØ¨ PWA Ø±ÙˆÛŒ **iOS Safari** (Ø¨Ø¯ÙˆÙ† Push - ÙÙ‚Ø· Local Notifications)
- âœ… Ù†ØµØ¨ PWA Ø±ÙˆÛŒ **Android**

### âš ï¸ **Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§:**

- âŒ iOS Safari Ù‡Ù†ÙˆØ² Ø§Ø² Web Push API Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (ÙÙ‚Ø· Safari 16.4+ Ø¯Ø± macOS)
- âš ï¸ Ø¯Ø± iOS ÙÙ‚Ø· Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø§Ø² Local Notifications Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯
- âš ï¸ Ø¨Ø±Ø§ÛŒ Push ÙˆØ§Ù‚Ø¹ÛŒ Ø¯Ø± iOS Ø¨Ø§ÛŒØ¯ Native App Ø¨Ø§ Capacitor Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯

---

## ğŸš€ Ù…Ø±Ø§Ø­Ù„ Ø¨Ø¹Ø¯ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)

Ø§Ú¯Ø± Ù†ÛŒØ§Ø² Ø¨Ù‡ Push Notification Ú©Ø§Ù…Ù„ Ø¯Ø± iOS Ø¯Ø§Ø±ÛŒØ¯:

1. **ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Native App Ø¨Ø§ Capacitor**
2. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Firebase Cloud Messaging (FCM)
3. ÛŒØ§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Ø´Ø®Øµ Ø«Ø§Ù„Ø« Ù…Ø«Ù„ OneSignal

---

## ğŸ“š Ù…Ù†Ø§Ø¨Ø¹ Ù…ÙÛŒØ¯

- [PWA Documentation](https://web.dev/progressive-web-apps/)
- [Web Push Notifications](https://developer.mozilla.org/en-US/docs/Web/API/Push_API)
- [Vite PWA Plugin](https://vite-pwa-org.netlify.app/)
- [Can I Use - Push API](https://caniuse.com/push-api)

---

## ğŸ¯ Ø®Ù„Ø§ØµÙ‡

Ø§ÛŒÙ† Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ù„Ø§Ù† ÛŒÚ© **PWA Ú©Ø§Ù…Ù„** Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª:
- Ù†ØµØ¨ Ø±ÙˆÛŒ Ú¯ÙˆØ´ÛŒ (iOS Ùˆ Android)
- Ú©Ø§Ø± Ø¢ÙÙ„Ø§ÛŒÙ†
- Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¯Ø± Android Ùˆ Desktop
- UX Ø¨Ù‡ØªØ± Ùˆ Ø³Ø±ÛŒØ¹â€ŒØªØ±

Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Push NotificationsØŒ ÙÙ‚Ø· Ø¨Ø§ÛŒØ¯:
1. VAPID Keys ØªÙˆÙ„ÛŒØ¯ Ú©Ù†ÛŒØ¯
2. Subscription Ø±Ø§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯  
3. Edge Function Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Push Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯
4. Ø§Ø² Triggers Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ ØªØ§ Ø®ÙˆØ¯Ú©Ø§Ø± Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯
